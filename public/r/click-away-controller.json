{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "click-away-controller",
  "type": "registry:lib",
  "title": "Click Away Controller",
  "author": "Lloyd Richards <lloyd.d.richards@gmail.com>",
  "description": "Reactive controller for detecting clicks outside a component. Useful for closing dropdowns, menus, and modals when clicking outside. Features conditional activation, multiple excluded elements support, and capture vs bubbling phase control.",
  "dependencies": [],
  "files": [
    {
      "path": "registry/controllers/click-away-controller.ts",
      "content": "/**\n * ClickAwayController - Reactive controller for click-outside detection\n *\n * Provides reusable logic for detecting clicks outside a component\n * and triggering a callback. Commonly used in dropdowns, menus, and modals.\n *\n * Used by: dropdown-menu, context-menu, menubar, select\n */\n\nimport type { ReactiveController, ReactiveControllerHost } from \"lit\";\n\n/**\n * Configuration options for the ClickAwayController\n */\nexport interface ClickAwayConfig {\n  /**\n   * Callback when a click outside is detected\n   */\n  onClickAway: () => void;\n\n  /**\n   * Function to check if the controller should be active\n   * Returns true when click-away detection should be enabled\n   * @default () => true\n   */\n  isActive?: () => boolean;\n\n  /**\n   * Additional elements to exclude from click-away detection\n   * Clicks on these elements will NOT trigger onClickAway\n   * @default []\n   */\n  excludeElements?: () => HTMLElement[];\n\n  /**\n   * Whether to use capture phase for click detection\n   * @default false\n   */\n  useCapture?: boolean;\n}\n\n/**\n * Reactive controller for click-outside detection\n *\n * @example\n * ```typescript\n * export class DropdownMenu extends BaseElement {\n *   @property({ type: Boolean }) open = false;\n *\n *   private clickAway = new ClickAwayController(this, {\n *     onClickAway: () => { this.open = false; },\n *     isActive: () => this.open,\n *     excludeElements: () => {\n *       const content = this.querySelector(\"ui-dropdown-menu-content\");\n *       return content ? [content] : [];\n *     },\n *   });\n *\n *   override updated(changed: PropertyValues) {\n *     super.updated(changed);\n *     if (changed.has('open')) {\n *       this.clickAway.update();\n *     }\n *   }\n * }\n * ```\n */\nexport class ClickAwayController implements ReactiveController {\n  private host: ReactiveControllerHost & HTMLElement;\n  private config: Required<ClickAwayConfig>;\n  private isListening = false;\n\n  constructor(\n    host: ReactiveControllerHost & HTMLElement,\n    config: ClickAwayConfig,\n  ) {\n    this.host = host;\n    this.config = {\n      isActive: () => true,\n      excludeElements: () => [],\n      useCapture: false,\n      ...config,\n    };\n    host.addController(this);\n  }\n\n  hostConnected(): void {\n    // Controller is ready\n  }\n\n  hostDisconnected(): void {\n    this.stopListening();\n  }\n\n  /**\n   * Handle click events\n   */\n  private handleClick = (e: MouseEvent): void => {\n    if (!this.config.isActive()) {\n      return;\n    }\n\n    const target = e.target;\n    if (!(target instanceof Node)) {\n      return;\n    }\n\n    if (this.host.contains(target)) {\n      return;\n    }\n\n    const excludedElements = this.config.excludeElements();\n    for (const element of excludedElements) {\n      if (element.contains(target)) {\n        return;\n      }\n    }\n\n    this.config.onClickAway();\n  };\n\n  private startListening(): void {\n    if (this.isListening) return;\n\n    setTimeout(() => {\n      document.addEventListener(\n        \"click\",\n        this.handleClick,\n        this.config.useCapture,\n      );\n      this.isListening = true;\n    }, 0);\n  }\n\n  private stopListening(): void {\n    if (!this.isListening) return;\n\n    document.removeEventListener(\n      \"click\",\n      this.handleClick,\n      this.config.useCapture,\n    );\n    this.isListening = false;\n  }\n\n  update(): void {\n    if (this.config.isActive()) {\n      this.startListening();\n    } else {\n      this.stopListening();\n    }\n  }\n  start(): void {\n    this.startListening();\n  }\n  stop(): void {\n    this.stopListening();\n  }\n}\n\nexport default ClickAwayController;\n",
      "type": "registry:lib"
    }
  ],
  "categories": [
    "lib",
    "controller",
    "web-component"
  ]
}