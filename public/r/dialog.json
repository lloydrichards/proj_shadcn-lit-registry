{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "dialog",
  "type": "registry:component",
  "title": "Dialog",
  "author": "Lloyd Richards <lloyd.d.richards@gmail.com>",
  "description": "A modal dialog component that overlays content on the primary window. Uses native HTML dialog element with smooth animations, focus management, and accessibility features. Supports ESC key and backdrop click to close.",
  "dependencies": [
    "lucide-static",
    "@lit/context"
  ],
  "registryDependencies": [
    "@lit/base-element",
    "@lit/focus-trap-controller",
    "@lit/animations"
  ],
  "files": [
    {
      "path": "registry/ui/dialog/dialog.ts",
      "content": "import { consume, createContext, provide } from \"@lit/context\";\nimport { css, html, nothing } from \"lit\";\nimport { customElement, property, query, state } from \"lit/decorators.js\";\nimport { unsafeSVG } from \"lit/directives/unsafe-svg.js\";\nimport { X } from \"lucide-static\";\nimport { FocusTrapController } from \"@/controllers/focus-trap-controller\";\nimport {\n  animations,\n  prefersReducedMotion,\n  waitForAnimation,\n} from \"@/registry/lib/animations\";\nimport { BaseElement } from \"@/registry/lib/base-element\";\nimport { cn, uid } from \"@/registry/lib/utils\";\n\n/**\n * Dialog Context\n *\n * Shares state between dialog root and child components using @lit/context\n */\nexport type DialogContext = {\n  open: boolean;\n  modal: boolean;\n  setOpen: (open: boolean, reason?: string) => void;\n  titleId?: string;\n  descriptionId?: string;\n};\n/**\n * Context for sharing dialog state between components\n * Used by ui-dialog (provider) and child components (consumers)\n */\n\nexport const dialogContext = createContext<DialogContext>(Symbol(\"dialog\"));\n\n/**\n * Dialog component properties\n */\nexport type DialogProperties = {\n  open?: boolean;\n  modal?: boolean;\n};\n\nexport type DialogTriggerProperties = {\n  disabled?: boolean;\n};\n\nexport type DialogContentProperties = {\n  closeOnEscape?: boolean;\n  closeOnBackdrop?: boolean;\n  preventScroll?: boolean;\n};\n\nexport type DialogCloseEvent = {\n  reason: \"escape\" | \"backdrop\" | \"close-button\" | \"programmatic\";\n};\n\nexport type DialogOpenChangeEvent = CustomEvent & {\n  detail: { open: boolean };\n};\n\n/**\n * Root dialog container managing state\n *\n * @element ui-dialog\n * @slot - Dialog content (typically ui-dialog-trigger and ui-dialog-content)\n * @fires dialog-open-change - When dialog open state changes\n * @fires dialog-close - When dialog closes with reason\n */\n@customElement(\"ui-dialog\")\nexport class Dialog extends BaseElement implements DialogProperties {\n  static styles = css`\n    :host {\n      display: contents;\n    }\n  `;\n\n  @provide({ context: dialogContext })\n  @state()\n  _context!: DialogContext;\n\n  @property({ type: Boolean, reflect: true }) open = false;\n  @property({ type: Boolean }) modal = true;\n\n  @state() private titleId?: string;\n  @state() private descriptionId?: string;\n\n  override willUpdate(changedProperties: Map<PropertyKey, unknown>) {\n    super.willUpdate(changedProperties);\n\n    // Update context when relevant properties change\n    if (\n      changedProperties.has(\"open\") ||\n      changedProperties.has(\"modal\") ||\n      changedProperties.has(\"titleId\") ||\n      changedProperties.has(\"descriptionId\") ||\n      !this._context\n    ) {\n      this._context = {\n        open: this.open,\n        modal: this.modal,\n        setOpen: (open: boolean, reason?: string) => this.setOpen(open, reason),\n        titleId: this.titleId,\n        descriptionId: this.descriptionId,\n      };\n    }\n\n    // Emit public event\n    if (changedProperties.has(\"open\")) {\n      this.emit(\"dialog-open-change\", { open: this.open });\n    }\n  }\n\n  private setOpen(open: boolean, reason = \"programmatic\") {\n    const oldOpen = this.open;\n    this.open = open;\n\n    if (!open && oldOpen) {\n      this.emit(\"dialog-close\", { reason });\n    }\n  }\n\n  setTitleId(id: string) {\n    this.titleId = id;\n  }\n\n  setDescriptionId(id: string) {\n    this.descriptionId = id;\n  }\n\n  render() {\n    return html`<slot></slot>`;\n  }\n\n  // Public API\n  showModal() {\n    this.modal = true;\n    this.open = true;\n  }\n\n  show() {\n    this.modal = false;\n    this.open = true;\n  }\n\n  close(reason = \"programmatic\") {\n    this.setOpen(false, reason);\n  }\n}\n\n/**\n * Dialog trigger button\n *\n * @element ui-dialog-trigger\n * @slot - Trigger content (typically a button)\n */\n@customElement(\"ui-dialog-trigger\")\nexport class DialogTrigger\n  extends BaseElement\n  implements DialogTriggerProperties\n{\n  static styles = css`\n    :host {\n      display: contents;\n    }\n  `;\n\n  @consume({ context: dialogContext, subscribe: true })\n  @property({ attribute: false })\n  private _dialogContext?: DialogContext;\n\n  @property({ type: Boolean }) disabled = false;\n\n  render() {\n    return html`\n      <button\n        part=\"trigger\"\n        type=\"button\"\n        @click=${this.handleClick}\n        ?disabled=${this.disabled}\n        aria-haspopup=\"dialog\"\n        aria-expanded=${this._dialogContext?.open ? \"true\" : \"false\"}\n        class=${cn(\"inline-flex items-center justify-center\", this.className)}\n      >\n        <slot></slot>\n      </button>\n    `;\n  }\n\n  private handleClick = () => {\n    if (!this.disabled && this._dialogContext) {\n      this._dialogContext.setOpen(!this._dialogContext.open, \"trigger\");\n    }\n  };\n}\n\n/**\n * Dialog content with native dialog element\n *\n * @element ui-dialog-content\n * @slot - Dialog content\n * @csspart backdrop - The backdrop overlay\n * @csspart dialog - The dialog element\n * @csspart content - The content wrapper\n * @fires dialog-open - When dialog opens\n * @fires dialog-close - When dialog closes\n * @fires dialog-dismiss - When user attempts to dismiss\n */\n@customElement(\"ui-dialog-content\")\nexport class DialogContent\n  extends BaseElement\n  implements DialogContentProperties\n{\n  static styles = css`\n    :host {\n      display: contents;\n    }\n\n    dialog {\n      padding: 0;\n      border: none;\n      background: transparent;\n      max-width: 100vw;\n      max-height: 100vh;\n    }\n\n    dialog::backdrop {\n      background-color: rgba(0, 0, 0, 0.8);\n    }\n  `;\n\n  @consume({ context: dialogContext, subscribe: true })\n  @property({ attribute: false })\n  private _dialogContext?: DialogContext;\n\n  @property({ type: Boolean }) closeOnEscape = true;\n  @property({ type: Boolean }) closeOnBackdrop = true;\n  @property({ type: Boolean }) preventScroll = true;\n\n  @state() private animationState: \"idle\" | \"entering\" | \"entered\" | \"exiting\" =\n    \"idle\";\n\n  @state() private _previousOpen?: boolean;\n\n  @query(\"dialog\") private dialogElement!: HTMLDialogElement;\n\n  private previousFocus?: HTMLElement;\n\n  // Focus trap controller\n  private focusTrap = new FocusTrapController(this, {\n    getContainer: () => this.dialogElement,\n    isActive: () => this._dialogContext?.open ?? false,\n    autoFocus: true,\n    restoreFocus: false, // We handle restore manually with previousFocus\n  });\n\n  override connectedCallback() {\n    super.connectedCallback();\n    document.addEventListener(\"keydown\", this.handleGlobalKeyDown);\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    document.removeEventListener(\"keydown\", this.handleGlobalKeyDown);\n\n    if (this.preventScroll) {\n      document.body.style.overflow = \"\";\n    }\n  }\n\n  override willUpdate(changedProperties: Map<PropertyKey, unknown>) {\n    super.willUpdate(changedProperties);\n\n    // Derive animation state from context.open\n    const contextOpen = this._dialogContext?.open;\n\n    // Trigger state update if context changed or dialog open state changed\n    if (\n      changedProperties.has(\"_dialogContext\") ||\n      this._previousOpen !== contextOpen\n    ) {\n      this._previousOpen = contextOpen;\n\n      if (contextOpen && this.animationState === \"idle\") {\n        this.animationState = \"entering\";\n      } else if (!contextOpen && this.animationState === \"entered\") {\n        this.animationState = \"exiting\";\n      }\n    }\n  }\n\n  override updated(changedProperties: Map<PropertyKey, unknown>) {\n    super.updated(changedProperties);\n\n    // Schedule async operations AFTER render completes\n    if (changedProperties.has(\"animationState\")) {\n      if (this.animationState === \"entering\") {\n        this.updateComplete.then(() => this.performOpenDialog());\n      } else if (this.animationState === \"exiting\") {\n        this.updateComplete.then(() => this.performCloseDialog());\n      }\n    }\n  }\n\n  render() {\n    if (this.animationState === \"idle\" && !this._dialogContext?.open) {\n      return nothing;\n    }\n\n    const isOpen =\n      this.animationState === \"entering\" || this.animationState === \"entered\";\n\n    return html`\n      <dialog\n        part=\"dialog\"\n        ?open=${false}\n        @cancel=${this.handleCancel}\n        @click=${this.handleDialogClick}\n        aria-modal=${this._dialogContext?.modal ? \"true\" : \"false\"}\n        aria-labelledby=${this._dialogContext?.titleId || nothing}\n        aria-describedby=${this._dialogContext?.descriptionId || nothing}\n        data-state=${isOpen ? \"open\" : \"closed\"}\n        class=${cn(\n          \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg\",\n          \"translate-x-[-50%] translate-y-[-50%]\",\n          \"gap-4 border bg-background p-6 shadow-lg\",\n          \"duration-200 sm:rounded-lg\",\n          !prefersReducedMotion() && isOpen && animations.dialogShow,\n          !prefersReducedMotion() && !isOpen && animations.dialogHide,\n          this.className,\n        )}\n      >\n        <div part=\"content\" role=\"document\">\n          <slot></slot>\n          ${this.renderCloseButton()}\n        </div>\n      </dialog>\n    `;\n  }\n\n  private renderCloseButton() {\n    return html`\n      <button\n        part=\"close-button\"\n        @click=${() => this.dismiss(\"close-button\")}\n        class=${cn(\n          \"absolute right-4 top-4 rounded-sm opacity-70\",\n          \"ring-offset-background transition-opacity\",\n          \"hover:opacity-100\",\n          \"focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n          \"disabled:pointer-events-none\",\n        )}\n        aria-label=\"Close dialog\"\n      >\n        ${unsafeSVG(X)}\n        <span class=\"sr-only\">Close</span>\n      </button>\n    `;\n  }\n\n  private async performOpenDialog() {\n    // Store previous focus\n    this.previousFocus = document.activeElement as HTMLElement;\n\n    // Prevent body scroll\n    if (this.preventScroll) {\n      document.body.style.overflow = \"hidden\";\n    }\n\n    await this.updateComplete;\n\n    // Show dialog\n    if (this.dialogElement) {\n      if (this._dialogContext?.modal) {\n        this.dialogElement.showModal();\n      } else {\n        this.dialogElement.show();\n      }\n\n      // Set up focus trap (handles auto-focus automatically)\n      this.focusTrap.update();\n\n      // Wait for animation\n      await waitForAnimation(this.dialogElement);\n\n      this.animationState = \"entered\";\n\n      this.emit(\"dialog-open\");\n    }\n  }\n\n  private async performCloseDialog() {\n    // Clean up focus trap\n    this.focusTrap.stop();\n\n    // Wait for exit animation\n    if (this.dialogElement) {\n      await waitForAnimation(this.dialogElement);\n    }\n\n    // Close dialog element\n    this.dialogElement?.close();\n\n    // Restore focus\n    this.previousFocus?.focus();\n\n    // Restore scroll\n    if (this.preventScroll) {\n      document.body.style.overflow = \"\";\n    }\n\n    this.animationState = \"idle\";\n\n    this.emit(\"dialog-close\");\n  }\n\n  private dismiss(reason: string) {\n    // Check if dismissal is allowed\n    const eventNotCancelled = this.emit(\n      \"dialog-dismiss\",\n      { reason },\n      { cancelable: true },\n    );\n\n    if (eventNotCancelled) {\n      this._dialogContext?.setOpen(false, reason);\n    }\n  }\n\n  private handleCancel = (e: Event) => {\n    e.preventDefault();\n    if (this.closeOnEscape) {\n      this.dismiss(\"escape\");\n    }\n  };\n\n  private handleDialogClick = (e: MouseEvent) => {\n    // Check if click is on backdrop (dialog element itself)\n    if (e.target === this.dialogElement && this.closeOnBackdrop) {\n      this.dismiss(\"backdrop\");\n    }\n  };\n\n  private handleGlobalKeyDown = (e: KeyboardEvent) => {\n    if (e.key === \"Escape\" && this._dialogContext?.open && this.closeOnEscape) {\n      e.preventDefault();\n      this.dismiss(\"escape\");\n    }\n  };\n}\n\n/**\n * Dialog header container\n *\n * @element ui-dialog-header\n * @slot - Header content (typically ui-dialog-title and ui-dialog-description)\n */\n@customElement(\"ui-dialog-header\")\nexport class DialogHeader extends BaseElement {\n  render() {\n    return html`\n      <div\n        class=${cn(\n          \"flex flex-col space-y-1.5 text-center sm:text-left\",\n          this.className,\n        )}\n      >\n        <slot></slot>\n      </div>\n    `;\n  }\n}\n\n/**\n * Dialog title (required for accessibility)\n *\n * @element ui-dialog-title\n * @slot - Title text\n */\n@customElement(\"ui-dialog-title\")\nexport class DialogTitle extends BaseElement {\n  @property({ type: String }) id = `dialog-title-${uid()}`;\n\n  private dialog?: Dialog;\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    // Register with parent dialog\n    this.dialog = this.closest(\"ui-dialog\") as Dialog;\n    if (this.dialog) {\n      this.dialog.setTitleId(this.id);\n    }\n  }\n\n  render() {\n    return html`\n      <h2\n        id=${this.id}\n        part=\"title\"\n        class=${cn(\n          \"text-lg font-semibold leading-none tracking-tight\",\n          this.className,\n        )}\n      >\n        <slot></slot>\n      </h2>\n    `;\n  }\n}\n\n/**\n * Dialog description\n *\n * @element ui-dialog-description\n * @slot - Description text\n */\n@customElement(\"ui-dialog-description\")\nexport class DialogDescription extends BaseElement {\n  @property({ type: String }) id = `dialog-desc-${uid()}`;\n\n  private dialog?: Dialog;\n\n  override connectedCallback() {\n    super.connectedCallback();\n\n    // Register with parent dialog\n    this.dialog = this.closest(\"ui-dialog\") as Dialog;\n    if (this.dialog) {\n      this.dialog.setDescriptionId(this.id);\n    }\n  }\n\n  render() {\n    return html`\n      <p\n        id=${this.id}\n        part=\"description\"\n        class=${cn(\"text-sm text-muted-foreground\", this.className)}\n      >\n        <slot></slot>\n      </p>\n    `;\n  }\n}\n\n/**\n * Dialog footer container\n *\n * @element ui-dialog-footer\n * @slot - Footer content (typically buttons)\n */\n@customElement(\"ui-dialog-footer\")\nexport class DialogFooter extends BaseElement {\n  render() {\n    return html`\n      <div\n        class=${cn(\n          \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n          this.className,\n        )}\n      >\n        <slot></slot>\n      </div>\n    `;\n  }\n}\n\n/**\n * Dialog close button\n *\n * @element ui-dialog-close\n * @slot - Close button content (optional, defaults to X icon)\n */\n@customElement(\"ui-dialog-close\")\nexport class DialogClose extends BaseElement {\n  @consume({ context: dialogContext, subscribe: true })\n  @property({ attribute: false })\n  private _dialogContext?: DialogContext;\n\n  render() {\n    return html`\n      <button\n        type=\"button\"\n        part=\"close-button\"\n        class=${cn(\n          \"absolute top-4 right-4 rounded-sm opacity-70 ring-offset-background transition-opacity\",\n          \"hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n          \"disabled:pointer-events-none\",\n          this.className,\n        )}\n        @click=${this.handleClick}\n        aria-label=\"Close\"\n      >\n        <slot>${unsafeSVG(X)}</slot>\n        <span class=\"sr-only\">Close</span>\n      </button>\n    `;\n  }\n\n  private handleClick = () => {\n    this._dialogContext?.setOpen(false, \"close-button\");\n  };\n}\n\n// Register components in global type map\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"ui-dialog\": Dialog;\n    \"ui-dialog-trigger\": DialogTrigger;\n    \"ui-dialog-content\": DialogContent;\n    \"ui-dialog-header\": DialogHeader;\n    \"ui-dialog-title\": DialogTitle;\n    \"ui-dialog-description\": DialogDescription;\n    \"ui-dialog-footer\": DialogFooter;\n    \"ui-dialog-close\": DialogClose;\n  }\n\n  interface HTMLElementEventMap {\n    \"dialog-open-change\": DialogOpenChangeEvent;\n    \"dialog-close\": CustomEvent<DialogCloseEvent>;\n  }\n}\n",
      "type": "registry:ui"
    },
    {
      "path": "registry/ui/dialog/dialog.stories.ts",
      "content": "import \"./dialog\";\nimport type { Meta, StoryObj } from \"@storybook/web-components-vite\";\nimport { html } from \"lit\";\nimport type { DialogProperties } from \"./dialog\";\n\ntype DialogArgs = DialogProperties & {\n  triggerText?: string;\n  titleText?: string;\n  descriptionText?: string;\n  cancelText?: string;\n  continueText?: string;\n};\n\n/**\n * A window overlaid on either the primary window or another dialog window,\n * rendering the content underneath inert.\n */\nconst meta: Meta<DialogArgs> = {\n  title: \"ui/Dialog\",\n  component: \"ui-dialog\",\n  tags: [\"autodocs\"],\n  argTypes: {\n    open: {\n      control: \"boolean\",\n      description: \"Controls whether the dialog is open or closed\",\n    },\n    modal: {\n      control: \"boolean\",\n      description:\n        \"Whether the dialog is modal (blocks interaction with background)\",\n    },\n    triggerText: {\n      control: \"text\",\n      description: \"Text for the trigger button\",\n    },\n    titleText: {\n      control: \"text\",\n      description: \"Text for the dialog title\",\n    },\n    descriptionText: {\n      control: \"text\",\n      description: \"Text for the dialog description\",\n    },\n    cancelText: {\n      control: \"text\",\n      description: \"Text for the cancel button\",\n    },\n    continueText: {\n      control: \"text\",\n      description: \"Text for the continue button\",\n    },\n  },\n  args: {\n    open: false,\n    modal: true,\n    triggerText: \"Open\",\n    titleText: \"Are you absolutely sure?\",\n    descriptionText:\n      \"This action cannot be undone. This will permanently delete your account and remove your data from our servers.\",\n    cancelText: \"Cancel\",\n    continueText: \"Continue\",\n  },\n  render: (args) => html`\n    <ui-dialog .open=${args.open || false} .modal=${args.modal || false}>\n      <ui-dialog-trigger>\n        <button\n          type=\"button\"\n          class=\"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2\"\n        >\n          ${args.triggerText}\n        </button>\n      </ui-dialog-trigger>\n      <ui-dialog-content>\n        <ui-dialog-header>\n          <ui-dialog-title>${args.titleText}</ui-dialog-title>\n          <ui-dialog-description>\n            ${args.descriptionText}\n          </ui-dialog-description>\n        </ui-dialog-header>\n        <ui-dialog-footer class=\"gap-4\">\n          <button\n            type=\"button\"\n            class=\"hover:underline\"\n            @click=${(e: Event) => {\n              const dialog = (e.target as HTMLElement).closest(\"ui-dialog\");\n              if (dialog) dialog.open = false;\n            }}\n          >\n            ${args.cancelText}\n          </button>\n          <button\n            type=\"button\"\n            class=\"bg-primary text-primary-foreground rounded px-4 py-2\"\n            @click=${(e: Event) => {\n              const dialog = (e.target as HTMLElement).closest(\"ui-dialog\");\n              if (dialog) dialog.open = false;\n            }}\n          >\n            ${args.continueText}\n          </button>\n        </ui-dialog-footer>\n      </ui-dialog-content>\n    </ui-dialog>\n  `,\n  parameters: {\n    layout: \"centered\",\n  },\n};\n\nexport default meta;\n\ntype Story = StoryObj<DialogArgs>;\n\n/**\n * The default form of the dialog.\n */\nexport const Default: Story = {};\n\n/**\n * Dialog that starts in an open state.\n */\nexport const Open: Story = {\n  tags: [\"!dev\", \"!autodocs\"],\n  args: {\n    open: true,\n  },\n};\n\n/**\n * Non-modal dialog that allows interaction with the background.\n */\nexport const NonModal: Story = {\n  args: {\n    modal: false,\n  },\n};\n",
      "type": "registry:ui"
    }
  ],
  "categories": [
    "ui",
    "dialog",
    "modal",
    "web-component"
  ]
}