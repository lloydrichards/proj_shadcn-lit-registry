{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "menu-navigation-controller",
  "type": "registry:lib",
  "title": "Menu Navigation Controller",
  "author": "Lloyd Richards <lloyd.d.richards@gmail.com>",
  "description": "Reactive controller for keyboard navigation in menu-like components (dropdowns, context menus, selects). Features arrow key navigation, Home/End support, Enter/Space selection, Escape handling, typeahead search, and optional looping.",
  "dependencies": [],
  "files": [
    {
      "path": "registry/controllers/menu-navigation-controller.ts",
      "content": "/**\n * MenuNavigationController - Reactive controller for menu keyboard navigation\n *\n * Provides reusable keyboard navigation logic for menu-like components\n * including arrow keys, home/end, enter/space, and typeahead search.\n *\n * Used by: dropdown-menu, context-menu, menubar, select\n */\n\nimport type { ReactiveController, ReactiveControllerHost } from \"lit\";\n\n/**\n * Interface for menu items that can be navigated\n */\nexport interface NavigableMenuItem extends HTMLElement {\n  disabled?: boolean;\n  highlighted?: boolean;\n}\n\n/**\n * Configuration options for the MenuNavigationController\n */\nexport interface MenuNavigationConfig {\n  /**\n   * Function to get the current list of navigable items\n   */\n  getItems: () => NavigableMenuItem[];\n\n  /**\n   * Get the current highlighted index from host component\n   */\n  getHighlightedIndex: () => number;\n\n  /**\n   * Set the highlighted index in host component (triggers Lit reactivity)\n   */\n  setHighlightedIndex: (index: number) => void;\n\n  /**\n   * Callback when an item should be selected (Enter/Space pressed)\n   */\n  onSelect?: (item: NavigableMenuItem, index: number) => void;\n\n  /**\n   * Callback when Escape key is pressed\n   */\n  onEscape?: () => void;\n\n  /**\n   * Whether navigation should loop (wrap around)\n   * Can be a boolean or a getter function for reactivity\n   * @default true\n   */\n  loop?: boolean | (() => boolean);\n\n  /**\n   * Typeahead timeout in milliseconds\n   * @default 500\n   */\n  typeaheadTimeout?: number;\n\n  /**\n   * Orientation of the menu\n   * @default \"vertical\"\n   */\n  orientation?: \"vertical\" | \"horizontal\";\n}\n\n/**\n * Reactive controller for keyboard navigation in menu components\n *\n * @example\n * ```typescript\n * export class DropdownMenuContent extends BaseElement {\n *   @state() private highlightedIndex = -1;\n *\n *   private navigation = new MenuNavigationController(this, {\n *     getItems: () => this.getNavigableItems(),\n *     getHighlightedIndex: () => this.highlightedIndex,\n *     setHighlightedIndex: (index) => { this.highlightedIndex = index; },\n *     onSelect: (item) => item.click(),\n *     onEscape: () => this.close(),\n *     loop: () => this.loop, // Reactive getter\n *   });\n *\n *   override willUpdate(changed: PropertyValues) {\n *     super.willUpdate(changed);\n *     if (changed.has('highlightedIndex')) {\n *       const items = this.getNavigableItems();\n *       items.forEach((item, i) => {\n *         item.highlighted = i === this.highlightedIndex;\n *       });\n *     }\n *   }\n *\n *   private handleKeyDown = (e: KeyboardEvent) => {\n *     this.navigation.handleKeyDown(e);\n *   };\n * }\n * ```\n */\nexport class MenuNavigationController implements ReactiveController {\n  private config: MenuNavigationConfig & {\n    loop: boolean | (() => boolean);\n    typeaheadTimeout: number;\n    orientation: \"vertical\" | \"horizontal\";\n    onSelect: (item: NavigableMenuItem, index: number) => void;\n    onEscape: () => void;\n  };\n\n  private typeaheadString = \"\";\n  private typeaheadTimer?: number;\n\n  constructor(host: ReactiveControllerHost, config: MenuNavigationConfig) {\n    this.config = {\n      loop: true,\n      typeaheadTimeout: 500,\n      orientation: \"vertical\",\n      onSelect: () => {},\n      onEscape: () => {},\n      ...config,\n    };\n    host.addController(this);\n  }\n\n  private getLoop(): boolean {\n    const loop = this.config.loop;\n    return typeof loop === \"function\" ? loop() : loop;\n  }\n\n  hostConnected(): void {\n    // Controller is ready\n  }\n\n  hostDisconnected(): void {\n    if (this.typeaheadTimer) {\n      clearTimeout(this.typeaheadTimer);\n    }\n  }\n  handleKeyDown(e: KeyboardEvent): void {\n    const items = this.config.getItems();\n    if (items.length === 0) return;\n\n    const isVertical = this.config.orientation === \"vertical\";\n    const nextKey = isVertical ? \"ArrowDown\" : \"ArrowRight\";\n    const prevKey = isVertical ? \"ArrowUp\" : \"ArrowLeft\";\n\n    switch (e.key) {\n      case nextKey:\n        e.preventDefault();\n        this.navigateNext(items);\n        break;\n\n      case prevKey:\n        e.preventDefault();\n        this.navigatePrevious(items);\n        break;\n\n      case \"Home\":\n        e.preventDefault();\n        this.navigateToFirst(items);\n        break;\n\n      case \"End\":\n        e.preventDefault();\n        this.navigateToLast(items);\n        break;\n\n      case \"Enter\":\n      case \" \":\n        e.preventDefault();\n        this.selectHighlighted(items);\n        break;\n\n      case \"Escape\":\n        e.preventDefault();\n        this.config.onEscape();\n        break;\n\n      default:\n        // Handle typeahead for single character keys\n        if (e.key.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey) {\n          this.handleTypeahead(e.key, items);\n        }\n    }\n  }\n  private navigateNext(items: NavigableMenuItem[]): void {\n    const current = this.config.getHighlightedIndex();\n    let next: number;\n\n    if (this.getLoop()) {\n      next = (current + 1) % items.length;\n    } else {\n      next = Math.min(current + 1, items.length - 1);\n    }\n\n    this.config.setHighlightedIndex(next);\n  }\n  private navigatePrevious(items: NavigableMenuItem[]): void {\n    const current = this.config.getHighlightedIndex();\n    let prev: number;\n\n    if (this.getLoop()) {\n      prev = (current - 1 + items.length) % items.length;\n    } else {\n      prev = Math.max(current - 1, 0);\n    }\n\n    this.config.setHighlightedIndex(prev);\n  }\n  private navigateToFirst(_items: NavigableMenuItem[]): void {\n    this.config.setHighlightedIndex(0);\n  }\n  private navigateToLast(items: NavigableMenuItem[]): void {\n    this.config.setHighlightedIndex(items.length - 1);\n  }\n  private selectHighlighted(items: NavigableMenuItem[]): void {\n    const index = this.config.getHighlightedIndex();\n    if (index >= 0 && index < items.length) {\n      const item = items[index];\n      if (item && !item.disabled) {\n        this.config.onSelect(item, index);\n      }\n    }\n  }\n  private handleTypeahead(char: string, items: NavigableMenuItem[]): void {\n    if (this.typeaheadTimer) {\n      clearTimeout(this.typeaheadTimer);\n    }\n\n    this.typeaheadString += char.toLowerCase();\n\n    const matchIndex = items.findIndex((item) =>\n      item.textContent?.toLowerCase().startsWith(this.typeaheadString),\n    );\n\n    if (matchIndex >= 0) {\n      this.config.setHighlightedIndex(matchIndex);\n    }\n\n    this.typeaheadTimer = window.setTimeout(() => {\n      this.typeaheadString = \"\";\n    }, this.config.typeaheadTimeout);\n  }\n  reset(): void {\n    this.config.setHighlightedIndex(-1);\n    this.typeaheadString = \"\";\n    if (this.typeaheadTimer) {\n      clearTimeout(this.typeaheadTimer);\n    }\n  }\n  get currentIndex(): number {\n    return this.config.getHighlightedIndex();\n  }\n}\n\nexport default MenuNavigationController;\n",
      "type": "registry:lib"
    }
  ],
  "categories": [
    "lib",
    "controller",
    "web-component"
  ]
}